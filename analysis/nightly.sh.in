#!/bin/bash

wd='@CMAKE_SOURCE_DIR@/bin'
prog_dir=$(readlink -f $(dirname $0))
export PATH=@PYTHON_PATH@:$prog_dir:$PATH

if [ "$1" == "" ]; then
  y=`date -d yesterday +%Y-%m-%d`
else
  y=$1
fi

tsd='@PICKLES_DIR@'
od=${wd}/nightlies/${y}

if [ ! -d $od ]; then
    mkdir -p $od
else
    echo "$od already exists"
fi

export PYTHONUNBUFFERED=yes
export PYTHONPATH='@CMAKE_SOURCE_DIR@/lib':${PYTHONPATH}
cd ${od}

${wd}/job_sweeper.py -p 2 -start ${y} -end ${y} -t 1.0   -plot -save -wide -test Imbalance        -o ${od} > ${od}/imbalance-${y}.log 2>&1
${wd}/job_sweeper.py -p 2 -start ${y} -end ${y} -t 0.999 -plot -save -wide -test Idle             -o ${od} > ${od}/idle-${y}.log 2>&1
${wd}/job_sweeper.py -p 2 -start ${y} -end ${y} -t 0.001 -plot -save -wide -test LowFLOPS         -o ${od} > ${od}/lowflops-${y}.log 2>&1
${wd}/job_sweeper.py -p 2 -start ${y} -end ${y} -t 0.001 -plot -save -wide -test Catastrophe -N 2 -o ${od} > ${od}/catastrophe-${y}.log 2>&1
