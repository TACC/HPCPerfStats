#!/bin/bash
set -eu

prog=$(basename $0)
prog_dir=$(readlink -f $(dirname $0))

export PATH=python_path:$prog_dir:$PATH

tmp_dir=${tmp_dir:-/dev/shm/}
dst_dir=${dst_dir:-pickles_dir}

start=$(date --date="$(date --date=yesterday +%F) +0 hour")
end=$(date --date="$(date --date=yesterday +%F) +24 hour")

label_start=$(date --date="${start}" +%F)
label_end=$(date --date="${end}" +%F)


exec 0< /dev/null
exec 1> $tmp_dir/$prog.out.$label_start.$label_end
exec 2> $tmp_dir/$prog.err.$label_start.$label_end

set -x

mkdir $tmp_dir/$label_start
$prog_dir/job_pickles.py -dir $tmp_dir/$label_start -start "$start" -end "$end" -p 2

tar -C $tmp_dir -czf $dst_dir/$label_start.tar.gz $label_start
rm -r $tmp_dir/$label_start

